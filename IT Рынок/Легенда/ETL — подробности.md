Analytics / ETL Service

Analytics / ETL Service — это микросервис (или связка сервисов), который отвечает за сбор, преобразование и загрузку данных из транзакционной части системы в аналитическое хранилище. Его основная цель — предоставить бизнесу актуальные отчёты и дашборды по доставке, SLA, загрузке курьеров и удовлетворённости клиентов.

---

Откуда берёт данные

- **Kafka (`tracking.events`)** — основной источник, содержащий все статусы посылок. Это поток событий, из которого ETL формирует аналитические витрины.
    
- **PostgreSQL (OLTP)** — таблицы `shipments`, `shipment_events`, `clients`, `carriers`. Используется для начальной загрузки и периодических сверок.
    
- **Integrations_log** — для анализа качества интеграций с внешними перевозчиками (ошибки, задержки).
    

---

Что делает внутри (функционал)

- **Extract (извлечение):** подписывается на Kafka и забирает все новые события о посылках. Дополнительно по расписанию выгружает «bulk-данные» из PostgreSQL (например, раз в сутки для проверки консистентности).
    
- **Transform (преобразование):**
    
    - Нормализует данные (объединяет статусы из разных перевозчиков в единый формат).
        
    - Добавляет бизнес-атрибуты (например, метка SLA — выполнено/не выполнено).
        
    - Агрегирует данные по клиентам, регионам, перевозчикам.
        
    - Обогащает данными о времени доставки, причинах задержек, количестве обращений в поддержку.
        
- **Load (загрузка):** пишет подготовленные данные в аналитическую СУБД (часто это **ClickHouse** или отдельная реплика PostgreSQL/Greenplum).
    
- **ETL-пайплайны:** выполняются батчево (ежедневная агрегация) и стримингово (почти реальное время).
    
- **Очистка и ретеншн:** удаляет устаревшие данные из промежуточных таблиц, архивирует сырые логи.
    

---

Куда отправляет

- **Аналитическое хранилище (ClickHouse / PostgreSQL-реплика):** для BI-систем и аналитических отчётов.
    
- **BI-платформы (Power BI, Grafana, Metabase):** дашборды для бизнеса (скорость доставки, SLA, топ клиентов, проблемные регионы).
    
- **Kafka (`analytics.reports`)** — публикация агрегированных событий (например, «доставлено с опозданием»).
    
- **Monitoring (Prometheus/Grafana):** метрики выполнения ETL (время обработки, количество загруженных записей, ошибки).
    

---

**Итог:** Analytics / ETL Service превращает поток «сырых» событий в структурированные аналитические данные. Он обеспечивает бизнес отчётами в реальном времени, помогает оценивать SLA и находить узкие места в логистике, что напрямую влияет на стратегические решения компании.

Хочешь, я распишу пример **структуры витрин аналитики** (какие таблицы в ClickHouse/OLAP и какие KPI они покрывают)?