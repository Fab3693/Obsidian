Notification Service — это микросервис, отвечающий за доставку уведомлений клиентам и получателям посылок. Его основная цель — обеспечить своевременное информирование о ключевых изменениях (новый статус, прибытие в сортировочный центр, доставка, задержка). Сервис поддерживает несколько каналов коммуникации: email, SMS, push-уведомления.

Откуда берёт данные

- **Kafka (`tracking.events`)** — основной источник, содержащий события об изменении статусов посылок.
    
- **PostgreSQL (`templates`, `notification_logs`)** — хранит шаблоны сообщений для разных каналов и историю отправок.
    
- **Redis** — используется для кэширования шаблонов и временных данных (например, частота уведомлений для одного получателя, чтобы избежать спама).
    
- **API Gateway / BFF** — запросы на ручную отправку уведомлений (например, подтверждение email или reset пароля).
    

Что делает внутри (функционал)

- **Подписка на события:** получает статусы о посылках, определяет, нужно ли уведомлять клиента (например, при смене статуса на «доставлено» или «задержка»).
    
- **Персонализация:** подставляет данные в шаблон (имя клиента, трек-номер, дата доставки).
    
- **Форматирование сообщений:** генерирует текст или HTML-письмо, готовит payload для SMS или push.
    
- **Канальная маршрутизация:** выбирает подходящий канал уведомления в зависимости от предпочтений клиента (email/SMS/push).
    
- **Обработка ошибок:** повторная отправка при сбое (RetryTemplate), запись в DLQ (`dead.letters`) при превышении лимита.
    
- **Логирование:** фиксирует все отправки в `notification_logs` с полями: `shipmentId`, `recipient`, `channel`, `status`, `timestamp`.
    
- **Rate limiting:** защита от избыточной рассылки (ограничение количества уведомлений в сутки для одного пользователя).
    

Куда отправляет

- **Внешние сервисы:**
    
    - Email-провайдер (SMTP/REST API).
        
    - SMS-шлюз (REST).
        
    - Push-сервисы (Firebase, APNS).
        
- **PostgreSQL:** запись истории уведомлений и статуса отправки.
    
- **Kafka (`notifications.email`, `notifications.sms`)** — публикация сообщений для дальнейшей обработки worker-подсистемами.
    
- **Monitoring (Prometheus/Grafana):** метрики по доставляемости, задержкам, ошибкам.
    

**Итог:** Notification Service автоматизирует информирование клиентов, снижает нагрузку на поддержку и повышает прозрачность логистики для конечных пользователей.