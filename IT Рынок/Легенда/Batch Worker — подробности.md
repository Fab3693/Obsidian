Admin / Batch Worker Service

Admin / Batch Worker — это служебный микросервис, который отвечает за выполнение фоновых задач, плановых джобов и административных операций в системе. Его главная роль — разгрузить ядро (Tracking Service) и интеграционные сервисы от тяжёлых или периодических вычислений, которые не требуют мгновенной реакции.

---

Откуда берёт данные

- **PostgreSQL** — таблицы `shipments`, `shipment_events`, `integrations_log`, `retry_queue`, `dead_letters`.
    
- **Kafka (`dead.letters`, `tracking.events`)** — подписывается на «проблемные» события для повторной обработки и сверки.
    
- **Конфигурации (configs)** — отдельная таблица в БД или YAML-файлы с расписаниями и настройками джобов.
    

---

Что делает внутри (функционал)

- **Retry обработка:** периодически проверяет `retry_queue` и `dead_letters`, повторно пытается отправить события в Tracking Service, CRM или Notification Service.
    
- **Batch-запросы:** раз в N часов запускает массовые сверки — например, проверяет все посылки в статусе «в пути» дольше 10 дней и запрашивает актуальный статус у перевозчика.
    
- **Архивация:** переносит устаревшие данные из `shipment_events` в архивные таблицы или внешнее хранилище, чтобы разгрузить OLTP.
    
- **Очистка данных:** удаляет временные записи, очищает кэш или старые retry-записи.
    
- **Мониторинг SLA:** формирует отчёты о задержках (например, «20% посылок клиента X просрочены»).
    
- **Админ-функции:** обработка ручных команд от операторов (например, «перезапустить синхронизацию для клиента А»).
    
- **Планировщик:** использует Quartz/Spring Scheduler для запуска джобов по cron-расписанию.
    
- **Resilience:** все операции выполняются с retry, логированием и идемпотентностью, чтобы избежать дубликатов.
    

---

Куда отправляет

- **Kafka (`tracking.events`, `crm.sync`, `notifications.*`)** — публикует результаты повторной обработки.
    
- **PostgreSQL (`integrations_log`, `audit_logs`)** — сохраняет отчёты о выполненных задачах.
    
- **Monitoring (Prometheus/Grafana):** отправляет метрики по статусу джобов (успешные/ошибки, время выполнения).
    
- **Админ-интерфейсы:** через REST API предоставляет операторам доступ к управлению задачами (например, повторный запуск).
    

---

**Итог:** Admin / Batch Worker Service обеспечивает «хозяйственную» часть системы — обрабатывает ошибки, повторно запускает процессы, чистит и архивирует данные. Он повышает надёжность всей архитектуры и снижает нагрузку на критичные микросервисы.

Хочешь, я сделаю **сравнение Admin / Batch Worker и Integration Service** (чем они отличаются и где пересекаются)?