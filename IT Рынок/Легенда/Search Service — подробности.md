Search Service — это микросервис, отвечающий за быстрый и удобный поиск посылок и связанных с ними данных. Его задача — предоставить пользователям (как клиентам, так и операторам) гибкий механизм поиска по различным параметрам: номеру трека, телефону получателя, дате отправки, статусу и другим критериям.

---

### Откуда берёт данные

- **PostgreSQL** — основная база данных, таблицы `shipments`, `shipment_events`, `recipients`, `addresses`. Именно отсюда Search Service получает всю необходимую информацию.
    
- **Redis** — кэш для результатов частых поисковых запросов (например, повторные проверки одного и того же трек-номера).
    
- **Kafka (`tracking.events`)** — сервис подписан на поток событий, чтобы оперативно обновлять индексы поиска при изменении статуса посылки.
    

---

### Что делает внутри (функционал)

- **Фильтрация и сортировка:** поддерживает поиск по дате, статусу, клиенту, телефону получателя. Использует Spring Data JPA + Criteria API для построения сложных запросов.
    
- **Поиск по телефону:** индексирует номера получателей в отдельной таблице (`phone_index`), что ускоряет выдачу при частых запросах без трек-номера.
    
- **Полнотекстовый поиск:** при необходимости использует расширения PostgreSQL (GIN/TSVector) для поиска по адресу или ФИО.
    
- **Агрегация:** возвращает вместе с результатом ключевые атрибуты посылки: последний статус, дату отправки, прогнозируемую дату доставки.
    
- **Кэширование:** сохраняет результаты популярных запросов в Redis (например, топ-10 последних посылок клиента).
    
- **Обновление индексов:** при поступлении новых событий из Kafka обновляет записи в БД и кэше, чтобы поиск всегда был актуальным.
    
- **Безопасность:** учитывает авторизацию пользователя (через JWT claims), ограничивая видимость данных (например, клиент видит только свои отправления).
    

---

### Куда отправляет

- **API Gateway / BFF:** возвращает результаты поиска по REST в агрегированном виде для фронтенда.
    
- **PostgreSQL:** выполняет запросы и обновляет индексы.
    
- **Redis:** пишет и обновляет кэшированные результаты.
    
- **Monitoring:** публикует метрики поиска (время ответа, количество найденных записей, кэш-хиты).
    

---

**Итог:** Search Service обеспечивает быстрый, гибкий и безопасный доступ к данным о посылках. Благодаря индексации и кэшированию он выдерживает высокую нагрузку и ускоряет работу конечных пользователей.

Хочешь, я подробно распишу **архитектуру Search Service** (с индексами, схемами таблиц и стратегиями оптимизации запросов) на 300–400 слов?