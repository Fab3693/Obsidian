[[JUnit]]
[[Mockito]]
## Зачем нужны unit-тесты

- Проверяют корректность работы **отдельного класса** и его методов, при условии что остальной код работает правильно.
    
- Помогают быстро находить регрессии при изменении логики.
    
- Снижают риск ошибок при рефакторинге.
    

---

## Общие принципы

1. **Тесты независимы** — порядок их выполнения не должен влиять на результат.
    
2. **Не инициализировать лишнее** — моки только для нужных зависимостей.
    
3. **Структура теста**:
    
    - Arrange — подготовка данных.
        
    - Act — выполнение действия.
        
    - Assert — проверка результата.
        
4. **Именование** — включать название тестируемого метода и условие (`method_shouldDo_whenCondition`).
    

---

## Репозиторий

- Простой пример: сохранение и получение объекта по ID.
    
- Можно тестировать конкурентный доступ, но это отдельная задача.
    
- Тестируются **реальные объекты**, без моков.
    

---

## Сервис

- Часто проксирует вызовы к репозиторию.
    
- Репозиторий мокаем, потому что его тестировали отдельно.
    
- Используем `@Mock` и `@InjectMocks` для инициализации моков.
    
- Проверяем:
    
    - Результат выполнения.
        
    - Количество вызовов (`verify`).
        
    - Переданные аргументы (через `ArgumentCaptor`).
        

---

## Контроллер

- **"Тупые" контроллеры** — только проверки и вызовы сервисов, логики нет.
    
- Мокаем сервисы и мапперы.
    
- Настраиваем возвращаемые значения моков и проверяем корректность вызовов.
    

---

## Unit vs Integration

- **Unit-тест** — тестирует один класс, все зависимости мокируются.
    
- **Integration-тест** — несколько классов взаимодействуют реально (без моков).
    
- Для Spring: `@SpringBootTest` + тестовые бины, in-memory хранилище или Testcontainers.
    

---

## Покрытие тестами

- Покрытие удобно смотреть в IDE или CI/CD отчётах.
    
- Цель — максимально покрыть логику, а не просто методы.
    
- Даже простая строка кода в тестах может спасти от серьёзных багов при масштабировании проекта.
    

---

## Краткие советы

- Пишите тесты на **каждый метод** с учётом разных сценариев.
    
- Проверяйте **количество и параметры вызовов**.
    
- Разделяйте unit и integration тесты.
    
- Поддерживайте тесты актуальными при изменениях кода.
    

---
