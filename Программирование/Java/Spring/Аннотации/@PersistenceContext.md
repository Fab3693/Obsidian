### `@PersistenceContext`  
**Назначение**: Аннотация в Java EE/Jakarta EE и Spring для **внедрения контейнера управляемого `EntityManager`** в компоненты приложения (например, бины, сервисы). Позволяет работать с [[JPA]] (Java Persistence API) без ручного управления жизненным циклом `EntityManager`.

---

#### Ключевые особенности:
1. **Управление контейнером**:  
   Контейнер (сервер приложений или Spring) создает и инжектит `EntityManager`, связывая его с текущей **транзакцией**. Нет необходимости создавать/закрывать `EntityManager` вручную.

2. **Типы `EntityManager`**:  
   - **Транзакционный (`PersistenceContextType.TRANSACTION`)**:  
     `EntityManager` привязан к транзакции (по умолчанию).  
   - **Расширенный (`PersistenceContextType.EXTENDED`)**:  
     Сохраняет состояние между транзакциями (используется в stateful-компонентах).

3. **Синхронизация с транзакциями**:  
   При запуске транзакции контейнер автоматически связывает `EntityManager` с ней. Изменения сущностей отслеживаются и фиксируются при коммите транзакции.

---

#### Пример (Spring/Java EE):
```java
@Service
public class UserService {
    @PersistenceContext // Инжектит EntityManager
    private EntityManager em;

    public User getUser(Long id) {
        return em.find(User.class, id); // Использование без создания EM
    }
}
```

---

#### Где использовать:
- В **статистических EJB-компонентах** (Java EE).
- В **Spring-бинах** (при использовании JPA).
- Для доступа к БД через **репозитории или сервисы**.

---

#### Важно:
- Не требует `@Transactional` в Spring, но транзакции должны быть настроены для работы с БД.
- В Spring эквивалентна `@Autowired EntityManager`, но явно указывает на JPA-контекст.
- По умолчанию использует **единственный `EntityManagerFactory`**. Для мультитенантности требуется дополнительная настройка.

---

**Связанные термины**: [[JPA]], [[EntityManager]], [[Транзакции]], [[Spring Data JPA]].