Для каждой партиции две реплики
Один брокер это кафка контроллер, назначающий лидер реплики
Всегда пишем и читаем в лидер партиции/реплики
Оффсеты храним в системном топике
Консюмеров всегда меньше, чем партишнов
Один косюмер может потреблять только с одного партишна

зачем нужны партиции в топике Ответ: Для масштабируемости: мы можем распределить нагрузку по серверам. Также мы можем читать сообщения из множества партиций множеством консюмеров, что обеспечивает многопоточность.

как прочитать одно сообщение N раз ответ: для этого нужно использовать N консьюмер-групп на одном топике

соотношение кол-ва партиций и консьюмеров Ответ: Идеал одна партиция на одного слушателя (консюмера).
Если партиций меньше, сколько-то слушателей будет простаивать, но в случае отказа одного слушателя, его партицию может перехватить другой слушатель.
Если партиций больше, увеличится нагрузка на слушателей, т.к. они распределятся между ними.

продюсер кидает сообщение1 и сообщение2, как гарантировать порядок обработки Ответ: Последовательно они могут обрабатываться только если находятся в одной партции. Чтобы они попали в одну партицию, должен быть одинаковый ключ. Если у нас первое сообщение о создании задачи с id 1, второе об изменении статуса задачи с id 1, они отправятся одним батчем (если успеем в него влезть), попадут в одну партицию и будут прочитаны консьюмером в порядке живой очереди. Если же батчи будут разные, всё равно с одинаковым ключом попадут в одну партицию и также будут обработаны последовательно. 
Если мы отправляем сообщение №1 о задаче 1, а сообщение №2 о задаче 2 и хотим обрабатывать их последовательно, тогда нужно что-то придумать с ключом

![[Pasted image 20250827152902.png]]![[Pasted image 20250827152943.png]]![[Pasted image 20250827153000.png]]![[Pasted image 20250827153023.png]]